# SQL Queries in the Codebase

## Database Initialization (backend/src/config/initDb.js)
- `CREATE TABLE IF NOT EXISTS users (id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(50) UNIQUE NOT NULL, email VARCHAR(100) UNIQUE NOT NULL, password VARCHAR(255) NOT NULL, role ENUM('admin', 'staff') DEFAULT 'staff', is_active BOOLEAN DEFAULT TRUE, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP)`
- `CREATE TABLE IF NOT EXISTS personal_details (id INT AUTO_INCREMENT PRIMARY KEY, resident_id INT, first_name VARCHAR(255) NOT NULL, last_name VARCHAR(255) NOT NULL, middle_name VARCHAR(255), suffix VARCHAR(50), age INT NOT NULL, gender ENUM('Male', 'Female', 'Other') NOT NULL, religion VARCHAR(100) NOT NULL, civil_status ENUM('Single', 'Married', 'Widowed', 'Divorced', 'Separated') NOT NULL, address VARCHAR(500) NOT NULL, occupation VARCHAR(100), date_of_birth DATE NOT NULL, place_of_birth VARCHAR(255) NOT NULL, employment_status ENUM('Employed', 'Unemployed', 'Self-Employed', 'Student', 'Retired') NOT NULL, contact_no VARCHAR(20) NOT NULL, province VARCHAR(100) NOT NULL, educational_attainment ENUM('Elementary', 'High School', 'College', 'Vocational', 'Postgraduate', 'None') NOT NULL, certificate_type ENUM('Indigency', 'Residency', 'Clearance', 'Business Permit') NOT NULL, purpose VARCHAR(100) NOT NULL, pwd BOOLEAN NOT NULL DEFAULT FALSE, tenant BOOLEAN NOT NULL DEFAULT FALSE, house_owner_name VARCHAR(255), living_with_relative BOOLEAN NOT NULL DEFAULT FALSE, relative_name VARCHAR(255), relative_relationship VARCHAR(100), residency_length ENUM('Less than 1 year', '1-5 years', '6-10 years', 'More than 10 years') NOT NULL, registered_voter BOOLEAN NOT NULL DEFAULT FALSE, house_owner BOOLEAN NOT NULL DEFAULT FALSE, kasambahay BOOLEAN NOT NULL DEFAULT FALSE, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (resident_id) REFERENCES barangay_inhabitants(id) ON DELETE SET NULL, INDEX idx_resident_id (resident_id), INDEX idx_name (first_name, last_name), INDEX idx_certificate_type (certificate_type), INDEX idx_created_at (created_at))`
- `CREATE TABLE IF NOT EXISTS kasambahay_registration (id INT AUTO_INCREMENT PRIMARY KEY, resident_id INT, employer_name VARCHAR(255) NOT NULL, employer_address VARCHAR(500) NOT NULL, monthly_salary VARCHAR(100) NOT NULL, nature_of_work VARCHAR(100) NOT NULL, employment_arrangement ENUM('Full-time', 'Part-time', 'Contract') NOT NULL, sss_no VARCHAR(20), pagibig_no VARCHAR(20), philhealth_no VARCHAR(20), spouse_name VARCHAR(255), father_name VARCHAR(255), father_address VARCHAR(500), mother_name VARCHAR(255), mother_address VARCHAR(500), emergency_contact_person VARCHAR(255) NOT NULL, emergency_contact_no VARCHAR(20) NOT NULL, documents TEXT, agree_to_terms BOOLEAN NOT NULL DEFAULT FALSE, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (resident_id) REFERENCES barangay_inhabitants(id) ON DELETE SET NULL, INDEX idx_resident_id (resident_id), INDEX idx_employer_name (employer_name), INDEX idx_created_at (created_at))`
- `CREATE TABLE IF NOT EXISTS barangay_inhabitants (id INT AUTO_INCREMENT PRIMARY KEY, region VARCHAR(100) NOT NULL, province VARCHAR(100) NOT NULL, city_municipality VARCHAR(100) NOT NULL, barangay VARCHAR(100) NOT NULL, household_no VARCHAR(50) NOT NULL, address VARCHAR(500) NOT NULL, last_name VARCHAR(255) NOT NULL, first_name VARCHAR(255) NOT NULL, middle_name VARCHAR(255), qualifier VARCHAR(50), date_of_birth DATE NOT NULL, place_of_birth VARCHAR(255) NOT NULL, gender ENUM('Male', 'Female', 'Other') NOT NULL, civil_status ENUM('Single', 'Married', 'Widowed', 'Divorced', 'Separated') NOT NULL, citizenship VARCHAR(100) NOT NULL, occupation VARCHAR(100), housing_status ENUM('Owned', 'Rented', 'Mortgaged', 'Living with relatives') NOT NULL, years_residing INT NOT NULL, registered_voter ENUM('Yes', 'No') NOT NULL, health_problem VARCHAR(255), septic_tank ENUM('Yes', 'No', 'Not Applicable') NOT NULL, relationship_to_head VARCHAR(100) NOT NULL, date_accomplished DATE NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, INDEX idx_household_no (household_no), INDEX idx_name (first_name, last_name), INDEX idx_created_at (created_at))`
- `CREATE TABLE IF NOT EXISTS business_permits (id INT AUTO_INCREMENT PRIMARY KEY, resident_id INT, application_type ENUM('NEW', 'OLD') DEFAULT 'NEW', application_date DATE NOT NULL, business_name VARCHAR(255) NOT NULL, nature_of_business VARCHAR(255) NOT NULL, proprietor_name VARCHAR(255) NOT NULL, business_address VARCHAR(500) NOT NULL, brn_number VARCHAR(100) NOT NULL, dti_number VARCHAR(100) NOT NULL, mayors_permit_number VARCHAR(100) NOT NULL, date_issued DATE NOT NULL, email_address VARCHAR(100) NOT NULL, contact_number VARCHAR(20) NOT NULL, representative_name VARCHAR(255) NOT NULL, position VARCHAR(100) NOT NULL, privacy_consent BOOLEAN DEFAULT FALSE, control_number VARCHAR(20), amount_paid DECIMAL(10,2) DEFAULT 500.00, date_paid DATE, or_number VARCHAR(50), received_by VARCHAR(255), date_received DATE, valid_until DATE, applicant_signature VARCHAR(255), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, FOREIGN KEY (resident_id) REFERENCES barangay_inhabitants(id) ON DELETE SET NULL, INDEX idx_resident_id (resident_id), INDEX idx_proprietor_name (proprietor_name), INDEX idx_business_name (business_name), INDEX idx_application_date (application_date), INDEX idx_created_at (created_at))`
- `SELECT id FROM users WHERE username = ?`
- `INSERT INTO users (username, email, password, role) VALUES (?, ?, ?, ?)`

## Base Model (backend/src/models/BaseModel.js)
- `SELECT * FROM ${this.tableName}` (with optional ORDER BY, LIMIT, OFFSET)
- `SELECT * FROM ${this.tableName} WHERE id = ?`
- `SELECT * FROM ${this.tableName} WHERE ${placeholders}` (with optional ORDER BY, LIMIT, OFFSET)
- `INSERT INTO ${this.tableName} (${columns}) VALUES (${placeholders})`
- `UPDATE ${this.tableName} SET ${setClause} WHERE id = ?`
- `DELETE FROM ${this.tableName} WHERE id = ?`
- `SELECT COUNT(*) as count FROM ${this.tableName}` (with optional WHERE)

## Personal Details Model (backend/src/models/PersonalDetails.js)
- `SELECT id, CONCAT(first_name, ' ', COALESCE(middle_name, ''), ' ', last_name, COALESCE(CONCAT(' ', suffix), '')) as full_name, address, certificate_type as type, purpose, created_at as date_issued FROM personal_details ORDER BY created_at DESC LIMIT ?`
- `SELECT id, CONCAT(first_name, ' ', COALESCE(middle_name, ''), ' ', last_name, COALESCE(CONCAT(' ', suffix), '')) as full_name, address, certificate_type as type, purpose, created_at as date_issued FROM personal_details WHERE CONCAT(first_name, ' ', last_name) LIKE ? ORDER BY created_at DESC LIMIT ?`
- `SELECT COUNT(*) as total, COUNT(CASE WHEN pwd = 1 THEN 1 END) as pwd_count, COUNT(CASE WHEN registered_voter = 1 THEN 1 END) as voter_count, COUNT(CASE WHEN kasambahay = 1 THEN 1 END) as kasambahay_count FROM personal_details`
- `SELECT id, certificate_type, purpose, created_at as date_issued FROM personal_details WHERE resident_id = ? ORDER BY created_at DESC`

## Business Permit Model (backend/src/models/BusinessPermit.js)
- `SELECT id, proprietor_name, business_name, nature_of_business, business_address, created_at as date_issued FROM business_permits ORDER BY created_at DESC LIMIT ?`
- `SELECT id, proprietor_name, business_name, nature_of_business, business_address, created_at as date_issued FROM business_permits WHERE proprietor_name LIKE ? OR business_name LIKE ? ORDER BY created_at DESC LIMIT ?`
- `SELECT COUNT(*) as total FROM business_permits`
- `SELECT id, 'Business Permit' as type, business_name as category, created_at as date_issued FROM business_permits WHERE resident_id = ? ORDER BY created_at DESC`

## Barangay Inhabitants Model (backend/src/models/BarangayInhabitants.js)
- `SELECT id, CONCAT(first_name, ' ', COALESCE(middle_name, ''), ' ', last_name, COALESCE(CONCAT(' ', qualifier), '')) as name, address, 'Barangay Inhabitants Record' as type, relationship_to_head as category, created_at as date_issued FROM barangay_inhabitants ORDER BY created_at DESC LIMIT ?`
- `SELECT id, CONCAT(first_name, ' ', COALESCE(middle_name, ''), ' ', last_name, COALESCE(CONCAT(' ', qualifier), '')) as name, address, 'Barangay Inhabitants Record' as type, relationship_to_head as category, created_at as date_issued FROM barangay_inhabitants WHERE CONCAT(first_name, ' ', last_name) LIKE ? ORDER BY created_at DESC LIMIT ?`
- `SELECT COUNT(*) as total, COUNT(CASE WHEN gender = 'Male' THEN 1 END) as male_count, COUNT(CASE WHEN gender = 'Female' THEN 1 END) as female_count, AVG(years_residing) as avg_years_residing, COUNT(CASE WHEN registered_voter = 'Yes' THEN 1 END) as voter_count FROM barangay_inhabitants`
- `SELECT * FROM barangay_inhabitants WHERE household_no = ? ORDER BY relationship_to_head`

## Kasambahay Model (backend/src/models/Kasambahay.js)
- `SELECT id, employer_name as name, employer_address as address, 'Kasambahay Registration' as type, nature_of_work as category, created_at as date_issued FROM kasambahay_registration ORDER BY created_at DESC LIMIT ?`
- `SELECT id, employer_name as name, employer_address as address, 'Kasambahay Registration' as type, nature_of_work as category, created_at as date_issued FROM kasambahay_registration WHERE employer_name LIKE ? ORDER BY created_at DESC LIMIT ?`
- `SELECT COUNT(*) as total, COUNT(CASE WHEN employment_arrangement = 'Full-time' THEN 1 END) as full_time_count, COUNT(CASE WHEN employment_arrangement = 'Part-time' THEN 1 END) as part_time_count, AVG(CAST(REPLACE(REPLACE(monthly_salary, 'â‚±', ''), ',', '') AS DECIMAL(10,2))) as avg_salary FROM kasambahay_registration`
- `SELECT id, 'Kasambahay Registration' as type, nature_of_work as category, created_at as date_issued FROM kasambahay_registration WHERE resident_id = ? ORDER BY created_at DESC`

## User Model (backend/src/models/User.js)
- `SELECT id, username, email, role, created_at FROM users WHERE is_active = 1 ORDER BY created_at DESC`
